---
phase: 01-campaign-structure-star-system-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - components/StarCriteria.tsx
  - components/StarProgress.tsx
  - components/StarCelebration.tsx
  - index.css
autonomous: true

must_haves:
  truths:
    - "User sees star requirements before level starts with clear descriptions for each tier"
    - "User sees real-time star progress during gameplay with visual indicators"
    - "User sees animated star celebration at level completion with sequential reveal"
    - "Star animations are CSS-based for performance (no heavy animation library)"
  artifacts:
    - path: "components/StarCriteria.tsx"
      provides: "Pre-level modal showing 1/2/3 star requirements"
      exports: ["StarCriteria"]
      min_lines: 30
    - path: "components/StarProgress.tsx"
      provides: "In-game HUD showing current star progress"
      exports: ["StarProgress"]
      min_lines: 25
    - path: "components/StarCelebration.tsx"
      provides: "Victory screen star reveal animation"
      exports: ["StarCelebration"]
      min_lines: 40
  key_links:
    - from: "components/StarCriteria.tsx"
      to: "services/starCalculation.ts"
      via: "import StarCriteria type"
      pattern: "import.*StarCriteria.*starCalculation"
    - from: "components/StarProgress.tsx"
      to: "services/starCalculation.ts"
      via: "import calculateCurrentStars"
      pattern: "import.*calculateCurrentStars"
    - from: "components/StarCelebration.tsx"
      to: "index.css"
      via: "CSS keyframe animations"
      pattern: "star-pop|star-fill"
---

<objective>
Create three React components for star system UI: pre-level criteria display, in-game progress HUD, and victory celebration animation.

Purpose: These components implement the user-facing star experience (STAR-02, STAR-03). Without visible star criteria and real-time feedback, players play "blind" — research shows this kills retention in hypercasual games.

Output: `components/StarCriteria.tsx`, `components/StarProgress.tsx`, `components/StarCelebration.tsx`, CSS keyframe additions to `index.css`
</objective>

<execution_context>
@/Users/martha2022/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martha2022/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-campaign-structure-star-system-foundation/01-RESEARCH.md
@.planning/phases/01-campaign-structure-star-system-foundation/01-01-SUMMARY.md

@types.ts
@services/starCalculation.ts
@index.css
@components/VinylCover.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StarCriteria pre-level display component</name>
  <files>components/StarCriteria.tsx</files>
  <action>
Create `components/StarCriteria.tsx` — a modal/overlay shown before a level starts, displaying what performance earns each star tier.

Props interface:
```typescript
interface StarCriteriaProps {
  levelNumber: number;
  levelName: string;
  mode: LevelMode;
  criteria: StarCriteria;  // from services/starCalculation.ts
  bestStars: number;       // 0-3, previous best for this level
  onStart: () => void;
}
```

Component requirements:
- Display level number and name prominently at top
- Show 3 rows, one per star tier:
  - Row 1: Single star icon + "Complete the level" (always same for 1-star)
  - Row 2: Two star icons + criteria.twoStar.description
  - Row 3: Three star icons + criteria.threeStar.description
- If bestStars > 0, show previous best with filled star icons and "Your best: X stars" text
- Star icons: Use inline SVG star path (same as lucide Star but self-contained). Filled = gold (#FFD700), unfilled = gray outline
- "Start Level" button at bottom, prominent and tappable (min height 48px for mobile)
- Styling: Use Tailwind classes. Dark semi-transparent backdrop. Centered card with rounded corners. Match existing game aesthetic (see ThemeBackground component for color patterns)
- Include level mode badge (e.g., "TIMED" or "BOSS" badge if not Standard)
- Animation: Card should fade in with slight scale-up (use Tailwind animate classes or inline transition)
- Component must be skippable — tapping backdrop or pressing Escape also triggers onStart

Do NOT use lucide-react Star import (keep component self-contained for performance). Create a small StarIcon helper within the file.
  </action>
  <verify>
`npx tsc --noEmit` passes. Component exports StarCriteria. Has proper TypeScript props interface. Uses StarCriteria type from starCalculation service.
  </verify>
  <done>StarCriteria component renders pre-level star requirements with star icons, level info, mode badge, and start button. Shows previous best if available.</done>
</task>

<task type="auto">
  <name>Task 2: Create StarProgress HUD and StarCelebration components</name>
  <files>components/StarProgress.tsx, components/StarCelebration.tsx, index.css</files>
  <action>
**StarProgress.tsx** — In-game HUD showing real-time star progress:

Props interface:
```typescript
interface StarProgressProps {
  currentStars: number;  // 0-3, calculated by calculateCurrentStars
  criteria: StarCriteria;
  accuracy: number;      // 0-1, current accuracy ratio
  showDetails: boolean;  // Whether to show threshold text (true on desktop, false on mobile for space)
}
```

Component requirements:
- Display 3 small star icons horizontally
- Stars fill (gold) when currentStars >= their tier, gray outline when not yet achieved
- When a star transitions from unfilled to filled, add a brief pulse animation (CSS class toggle)
- On desktop (showDetails=true), show small text under stars: current accuracy percentage
- Position: Component renders inline (parent handles absolute positioning in game HUD)
- Keep minimal — this renders every frame during gameplay. No expensive calculations inside.
- Use `React.memo` to prevent unnecessary re-renders (only re-render when currentStars or accuracy changes)

**StarCelebration.tsx** — Victory screen star reveal:

Props interface:
```typescript
interface StarCelebrationProps {
  starsEarned: number;   // 1-3
  isNewBest: boolean;     // True if this is a new record for this level
  onComplete: () => void; // Called when animation finishes
  onSkip: () => void;     // Called when player taps to skip
}
```

Component requirements:
- 3 large star icons in a row (center of screen)
- Stars reveal sequentially with 400ms delay between each:
  - Earned stars: Pop in with scale animation (0 → 1.3 → 1.0) and gold fill, using CSS @keyframes
  - Unearned stars: Fade in as gray outlines after earned stars finish
- If isNewBest, show "New Best!" text with subtle glow animation after all stars revealed
- Show "Tap to continue" text after animation completes (after ~2 seconds)
- Tapping anywhere calls onSkip (don't force watching full animation)
- After all earned stars revealed + 500ms pause, call onComplete automatically
- Sound hook point: Add `data-sfx="star-reveal"` attribute on each star container (for future audio integration)

**index.css additions** — Add these CSS keyframes:
```css
@keyframes starPop {
  0% { transform: scale(0) rotate(-180deg); opacity: 0; }
  60% { transform: scale(1.3) rotate(10deg); opacity: 1; }
  80% { transform: scale(0.9) rotate(-5deg); }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

@keyframes starPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.15); }
}

@keyframes starGlow {
  0%, 100% { filter: drop-shadow(0 0 4px rgba(255, 215, 0, 0.6)); }
  50% { filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.9)); }
}
```

Add utility classes:
```css
.star-pop { animation: starPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
.star-pulse { animation: starPulse 0.4s ease-in-out; }
.star-glow { animation: starGlow 1.5s ease-in-out infinite; }
```

Important: Read `index.css` first before writing to avoid overwriting existing styles. Append the new keyframes at the end of the file.
  </action>
  <verify>
`npx tsc --noEmit` passes. All three components export correctly. StarProgress uses React.memo. StarCelebration has sequential animation logic. index.css has starPop, starPulse, starGlow keyframes.
  </verify>
  <done>StarProgress HUD shows real-time star progress with animated transitions. StarCelebration plays sequential star reveal animation at victory. CSS keyframes added for star-pop, star-pulse, and star-glow effects.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- All 3 components render star icons (self-contained SVG, no external dependency)
- StarCriteria shows criteria descriptions from StarCriteria type
- StarProgress is React.memo wrapped for performance
- StarCelebration has sequential reveal with timing
- CSS keyframes exist in index.css
- No lucide-react Star import in these components (self-contained)
</verification>

<success_criteria>
- User would see clear star requirements before level in StarCriteria (STAR-02)
- User would see real-time star status during gameplay in StarProgress (STAR-03)
- User would see satisfying star reveal animation at victory in StarCelebration (STAR-01)
- All animations CSS-based (no GSAP/Framer Motion dependency in Phase 1)
- Components ready for integration into App.tsx (Plan 04)
</success_criteria>

<output>
After completion, create `.planning/phases/01-campaign-structure-star-system-foundation/01-03-SUMMARY.md`
</output>
