---
phase: 02-core-ui-components
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ShelfSlot/ShelfSlot.tsx
autonomous: true
requirements:
  - COMP-02
  - A11Y-01

must_haves:
  truths:
    - "User sees wood grain texture on empty slots"
    - "User sees pulsing green glow for valid drop targets"
    - "User sees pulsing red glow for invalid drop targets"
    - "User sees recessed appearance when vinyl is placed"
    - "User sees sparkle/glimmer effect on correct placement"
    - "User can tap slot with thumb (44x44px minimum)"
  artifacts:
    - path: "src/components/ShelfSlot/ShelfSlot.tsx"
      provides: "Drop target with vintage shelf styling"
      exports: ["ShelfSlot", "ShelfSlotProps"]
      min_lines: 200
  key_links:
    - from: "src/components/ShelfSlot/ShelfSlot.tsx"
      to: "src/design-tokens/theme.ts"
      via: "props.theme access"
      pattern: "props\\.theme\\.(colors|spacing)"
---

<objective>
Update ShelfSlot component to add missing features from locked decisions: recessed filled state (vinyl inset into shelf) and sparkle/glimmer effect on correct placement. Preserve existing wood grain texture and pulsing glow.

Purpose: Current ShelfSlot has wood grain and glow but missing recessed filled state and sparkle effect per locked decisions.
Output: Updated ShelfSlot with all locked visual feedback features.
</objective>

<execution_context>
@/Users/martha2022/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martha2022/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-ui-components/02-CONTEXT.md
@.planning/phases/02-core-ui-components/02-RESEARCH.md

# Existing implementation to update
@src/components/ShelfSlot/ShelfSlot.tsx

# Design tokens from Phase 1
@src/design-tokens/theme.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add recessed filled state for placed vinyls</name>
  <files>src/components/ShelfSlot/ShelfSlot.tsx</files>
  <action>
Add recessed/inset appearance when a vinyl is placed in the slot:

1. **Recessed Filled State:**
   - When state === 'filled', add visual depth to show vinyl is inset into the shelf
   - Use inset box-shadow to create "well" effect: `inset 0 4px 8px rgba(0, 0, 0, 0.4)`
   - Add subtle inner border highlight on top edge: `inset 0 1px 0 rgba(255, 255, 255, 0.1)`
   - Consider reducing brightness/saturation slightly to simulate depth
   - The vinyl should appear to sit "inside" the slot, not on top of it

2. **Implementation:**
   Add CSS for filled state:
```css
${(props) => props.$state === 'filled' && css`
  box-shadow:
    inset 0 4px 12px rgba(0, 0, 0, 0.5),
    inset 0 2px 4px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
  background: linear-gradient(180deg,
    rgba(30, 20, 15, 0.95) 0%,
    rgba(20, 12, 8, 1) 100%
  );
`}
```

3. **Preserve Existing:**
   - Keep wood grain texture for empty state
   - Keep pulsing glow for highlight/invalid states
   - Keep FeedbackIcon with check/X marks
   - Keep 140x180px dimensions
   - Keep all ARIA attributes
</action>
  <verify>
npm run build should complete without errors
grep -c "inset" src/components/ShelfSlot/ShelfSlot.tsx should return >= 1
</verify>
  <done>
ShelfSlot displays recessed/inset appearance when vinyl is placed, creating realistic shelf depth
</done>
</task>

<task type="auto">
  <name>Task 2: Add sparkle/glimmer effect on correct placement</name>
  <files>src/components/ShelfSlot/ShelfSlot.tsx</files>
  <action>
Add sparkle/glimmer animation that plays briefly when a vinyl is correctly placed:

1. **Sparkle Effect:**
   - Create a new styled component `SparkleEffect` that renders multiple small sparkle points
   - Sparkles should appear briefly (600-800ms) when state transitions to 'filled' and placement is correct
   - Use CSS animations with staggered delays for natural effect
   - Sparkles should be positioned around the edges of the slot

2. **Implementation:**
```tsx
const SparkleEffect = styled.div<{ $show: boolean }>`
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: ${(props) => props.$show ? 1 : 0};
  transition: opacity 0.3s ease;

  &::before, &::after {
    content: 'âœ¦';
    position: absolute;
    font-size: 12px;
    color: #ffd700;
    animation: sparkle 0.6s ease-out forwards;
    animation-delay: ${(props) => props.$show ? '0ms' : '0ms'};
  }

  &::before {
    top: 10%;
    left: 15%;
    animation-delay: 0ms;
  }

  &::after {
    top: 20%;
    right: 20%;
    animation-delay: 150ms;
  }

  @keyframes sparkle {
    0% { transform: scale(0) rotate(0deg); opacity: 1; }
    50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
    100% { transform: scale(0) rotate(360deg); opacity: 0; }
  }

  ${reducedMotion}
`;

// Add additional sparkle points via pseudo-elements or child elements
const SparkleContainer = styled.div<{ $show: boolean }>`
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: ${(props) => props.$show ? 1 : 0};
`;
```

3. **Trigger Logic:**
   - Add useState for showSparkle
   - Use useEffect to detect when state becomes 'filled'
   - Show sparkles for 800ms then hide
   - Only show sparkles for correct placement (not invalid)

4. **Multiple Sparkle Points:**
   - Create 4-6 sparkle points around the slot edges
   - Each with slightly different animation delays (0, 100, 200, 300ms)
   - Use gold/yellow color (#ffd700) for warmth

5. **Reduced Motion:**
   - Apply ${reducedMotion} mixin to disable animation for users who prefer reduced motion
</action>
  <verify>
npm run build should complete without errors
grep -c "sparkle" src/components/ShelfSlot/ShelfSlot.tsx should return >= 2 (lowercase insensitive)
</verify>
  <done>
ShelfSlot displays brief sparkle/glimmer effect when vinyl is correctly placed, respecting reduced motion preference
</done>
</task>

<task type="auto">
  <name>Task 3: Verify touch target compliance</name>
  <files>src/components/ShelfSlot/ShelfSlot.tsx</files>
  <action>
Ensure ShelfSlot meets 44x44px minimum touch target per WCAG 2.5.5:

1. **Current State:**
   - SlotWrapper is 140x180px which exceeds minimum
   - Verify this is maintained after all changes

2. **If Interactive Elements Inside:**
   - Any clickable/tappable children must also meet 44x44px
   - Add invisible padding if visual element is smaller

3. **Verification:**
   - Ensure min-width and min-height are set on SlotWrapper
   - Check that drag event handlers work correctly on the full area
</action>
  <verify>
grep -c "140px" src/components/ShelfSlot/ShelfSlot.tsx should return >= 1
grep -c "180px" src/components/ShelfSlot/ShelfSlot.tsx should return >= 1
npm run build should complete without errors
</verify>
  <done>
ShelfSlot maintains 140x180px dimensions (exceeds 44x44px minimum), all interactive areas are accessible
</done>
</task>

</tasks>

<verification>
1. ShelfSlot component exists at src/components/ShelfSlot/ShelfSlot.tsx
2. Filled state shows recessed/inset appearance (inset box-shadow)
3. Sparkle/glimmer effect plays on correct placement
4. Wood grain texture preserved for empty state
5. Pulsing glow preserved for highlight/invalid states
6. 140x180px dimensions maintained (exceeds 44x44px)
7. Reduced motion preference respected
8. Build completes without errors
</verification>

<success_criteria>
- Filled state shows vinyl recessed into shelf with inset shadow
- Sparkle effect (gold/yellow) briefly appears on correct placement
- Wood grain texture visible on empty slots
- Green glow pulses for valid drop targets
- Red glow pulses for invalid drop targets
- Touch target exceeds 44x44px minimum
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-ui-components/02-02-SUMMARY.md`
</output>
