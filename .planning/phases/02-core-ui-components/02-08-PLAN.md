---
phase: 02-core-ui-components
plan: "02-08"
type: execute
wave: 2
depends_on:
  - "02-07"
files_modified:
  - src/components/Counter.tsx
autonomous: false
gap_closure: true
requirements:
  - COMP-01
  - A11Y-01

must_haves:
  truths:
    - "User sees vinyl records in the counter area rendered as sleeve-style cards (100px width) with a vinyl disc peeking from the corner"
    - "User sees genre, year, and title (album name) overlaid on the art area of each card — not below the card"
    - "Each unplaced vinyl card has a minimum touch target of 44x44px (CardContainer wraps the sleeve)"
    - "User can drag a card from the counter to trigger drag handling (onDragStart fires)"
  artifacts:
    - path: "src/components/Counter.tsx"
      provides: "Counter rendering VinylCard components instead of VinylDisc"
      contains: "VinylCard"
  key_links:
    - from: "src/components/Counter.tsx"
      to: "src/components/VinylCard/VinylCard.tsx"
      via: "import { VinylCard } from './VinylCard/VinylCard'"
      pattern: "import.*VinylCard.*from.*VinylCard"
    - from: "src/components/Counter.tsx"
      to: "src/components/VinylCard/VinylCard.tsx"
      via: "<VinylCard> rendered in JSX for each unplaced vinyl"
      pattern: "<VinylCard "
---

<objective>
Wire `VinylCard/VinylCard.tsx` into `Counter.tsx` by replacing the `VinylDisc` rendering with `VinylCard` for each unplaced vinyl in the counter area.

Purpose: VinylCard is fully implemented with sleeve shape, text overlay, state feedback, and 44px touch target — but is orphaned. Counter renders VinylDisc (circular disc) instead. Replacing VinylDisc with VinylCard in Counter makes the locked design decisions (vinyl+sleeve shape, text overlay on art) visible to users.

Output: `Counter.tsx` imports and renders `<VinylCard>` for each unplaced vinyl, bridging the existing counter data shape (id, color, genre, year, album, artist, cover) to VinylCard's props (id, title, artist, genre, year, coverImage, state, onDragStart, onDragEnd).
</objective>

<execution_context>
@/Users/martha2022/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martha2022/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-ui-components/02-VERIFICATION.md
@src/components/Counter.tsx
@src/components/VinylCard/VinylCard.tsx
@src/components/GameScreen.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace VinylDisc with VinylCard in Counter</name>
  <files>src/components/Counter.tsx</files>
  <action>
    Update Counter.tsx to render VinylCard instead of VinylDisc. The Counter receives vinyls with this shape (from GameScreen):
    ```
    { id: string; color: string; genre: string; year: number; cover?: string; }
    ```
    But GameScreen also computes `artist` and `album` when building `unplacedVinyls`. Looking at GameScreen line 344-352, the unplaced vinyls array is:
    ```
    { id, color, genre, year, cover }
    ```
    — artist and album are NOT passed to Counter. The CounterVinyl interface in Counter.tsx must be extended to accept artist and album.

    Changes to make:

    1. **Update CounterVinyl interface** to include optional artist and album:
       ```typescript
       interface CounterVinyl {
         id: string;
         color: string;
         genre: string;
         year: number;
         cover?: string;
         artist?: string;
         album?: string;
       }
       ```

    2. **Add VinylCard import**, remove VinylDisc import:
       ```typescript
       import { VinylCard } from './VinylCard/VinylCard';
       ```
       Remove: `import { VinylDisc } from './VinylDisc';`

    3. **Update JSX** — Replace the VinylDisc render inside the `vinyls.map()`. The current render is:
       ```jsx
       <div key={v.id} className={styles.vinylSpot}>
         <div className={styles.shadow} />
         <VinylDisc
           vinylId={v.id}
           color={v.color}
           genre={v.genre}
           year={v.year}
           cover={v.cover}
           size={discSize}
           draggable
           shaking={shakingVinylId === v.id}
           onDragStart={onDragStart}
           onAnimationEnd={shakingVinylId === v.id ? onShakeEnd : undefined}
         />
       </div>
       ```
       Replace with:
       ```jsx
       <div key={v.id} className={styles.vinylSpot}>
         <VinylCard
           id={v.id}
           title={v.album ?? v.genre}
           artist={v.artist ?? ''}
           genre={v.genre}
           year={v.year}
           coverImage={v.cover}
           state={shakingVinylId === v.id ? 'dragging' : 'idle'}
           onDragStart={() => {}}
           onDragEnd={() => {}}
         />
       </div>
       ```
       Note: VinylCard uses `draggable` HTML attribute and `onDragStart`/`onDragEnd` callbacks (HTML5 drag API). However, GameScreen uses pointer events (onPointerDown), not HTML5 drag. VinylCard's `onDragStart`/`onDragEnd` are the HTML5 drag events, which are different from GameScreen's pointer-based drag system.

       To preserve the pointer-based drag system, wrap VinylCard in a div that intercepts onPointerDown:
       ```jsx
       <div
         key={v.id}
         className={styles.vinylSpot}
         onPointerDown={(e) => {
           e.preventDefault();
           onDragStart?.(v.id, v.color, e.clientX, e.clientY);
         }}
         style={{ cursor: 'grab', touchAction: 'none' }}
       >
         <VinylCard
           id={v.id}
           title={v.album ?? v.genre}
           artist={v.artist ?? ''}
           genre={v.genre}
           year={v.year}
           coverImage={v.cover}
           state="idle"
         />
       </div>
       ```
       The onPointerDown wrapper fires the existing GameScreen drag system. VinylCard's own drag props are not needed.

    4. **Remove `discSize` and `multiRow` calculations** since VinylCard has a fixed 100px width:
       Remove: `const multiRow = vinyls.length > 6;`
       Remove: `const discSize = vinyls.length > 9 ? 74 : vinyls.length > 6 ? 82 : 96;`
       Remove the `multiRow` conditional from the vinyls container class: change `${multiRow ? ` ${styles.vinylsMultiRow}` : ''}` to just `styles.vinyls`.

    5. **Keep the onShakeEnd** prop. The shakingVinylId/onShakeEnd system triggers a CSS shake animation via the `shaking` prop. Since VinylCard doesn't have a shaking prop, handle shake state by adding a CSS class to the wrapper div:
       Update the wrapper div for the shaking case:
       ```jsx
       <div
         key={v.id}
         className={`${styles.vinylSpot}${shakingVinylId === v.id ? ` ${styles.shaking}` : ''}`}
         onPointerDown={(e) => {
           e.preventDefault();
           onDragStart?.(v.id, v.color, e.clientX, e.clientY);
         }}
         onAnimationEnd={shakingVinylId === v.id ? onShakeEnd : undefined}
         style={{ cursor: 'grab', touchAction: 'none' }}
       >
         <VinylCard
           id={v.id}
           title={v.album ?? v.genre}
           artist={v.artist ?? ''}
           genre={v.genre}
           year={v.year}
           coverImage={v.cover}
           state="idle"
         />
       </div>
       ```
       Add `.shaking` class to `Counter.module.css` with the same shake keyframes used previously (copy from ShelfSlot or define: `animation: counterShake 0.4s ease-in-out;`).

    6. **Update GameScreen.tsx** unplacedVinyls mapping to pass artist and album:
       In GameScreen.tsx, the `unplacedVinyls` array (around line 344) currently maps:
       ```
       { id, color, genre: ..., year: ..., cover: ... }
       ```
       Add artist and album to this mapping:
       ```
       .map((id) => ({
         id,
         color: vinylMap.get(id)?.color ?? '#888',
         genre: vinylMap.get(id)?.genre ?? '',
         year: vinylMap.get(id)?.year ?? 0,
         cover: vinylMap.get(id)?.cover,
         artist: vinylMap.get(id)?.artist,
         album: vinylMap.get(id)?.album,
       }));
       ```
       This requires also adding `artist?: string; album?: string;` to GameScreen.tsx `files_modified` — make this change in GameScreen.tsx as well.
  </action>
  <verify>
    1. `npx tsc --noEmit` — zero TypeScript errors (especially in Counter.tsx and GameScreen.tsx)
    2. `npm run build` — build succeeds
    3. `grep -n "VinylCard" src/components/Counter.tsx` — VinylCard is imported and rendered
    4. `grep -n "VinylDisc" src/components/Counter.tsx` — VinylDisc is no longer imported or used
    5. `npm run dev` — dev server starts without runtime errors
  </verify>
  <done>
    Counter.tsx imports VinylCard and renders it for each unplaced vinyl.
    VinylDisc is no longer imported in Counter.tsx.
    Pointer-based drag still works (onPointerDown wrapper fires onDragStart).
    Shake animation works via CSS class on the wrapper div.
    TypeScript compiles clean. Build succeeds.
    GameScreen passes artist and album to Counter vinyls.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human visual verification of all three gap closure features</name>
  <action>Run npm run dev and verify all five visual behaviors listed in how-to-verify.</action>
  <what-built>
    Three gap closure fixes are now in place:
    1. ShelfSlot (02-06): Recessed inset shadow + gold sparkle effect on vinyl placement
    2. HUD (02-07): Transparent top bar with circular progress gauge, score, moves, timer — replacing InfoPanel
    3. VinylCard (02-08): Sleeve-style cards with text overlay replacing VinylDisc circles in the counter
  </what-built>
  <how-to-verify>
    Run `npm run dev` and open the game in a browser. Verify each feature:

    1. **HUD top bar** — Is there a transparent dark bar at the top showing Score (left), a circular ring gauge (center), and Moves (right)? The bar should let game content show through (backdrop blur). There should be NO level number label in the bar.

    2. **Counter cards** — Do the unplaced vinyls at the bottom appear as sleeve-style cards (rectangular, ~100px wide) with a vinyl disc peeking from the corner? Does genre/year/album text appear overlaid on the art area (not below the card)?

    3. **Drag still works** — Can you drag a card from the counter to a shelf slot? Does the ghost follow your pointer? Does the slot highlight green/red?

    4. **ShelfSlot recessed state** — After dropping a vinyl into a slot correctly, does the slot appear to sink slightly inward (inset shadow)? Do gold sparkle points (✦) appear briefly around the slot edges?

    5. **ShelfSlot sparkle** — After a correct placement, do small gold ✦ characters animate in and fade out around the slot?

    Describe any visual issues or confirm all five points look correct.
  </how-to-verify>
  <resume-signal>Type "approved" if all five points look correct, or describe the issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — zero TypeScript errors
2. `npm run build` — build succeeds
3. `grep "VinylCard" src/components/Counter.tsx` — import and render present
4. `grep "VinylDisc" src/components/Counter.tsx` — not found (removed)
5. Human verification checkpoint passed by user
</verification>

<success_criteria>
- Counter renders VinylCard (sleeve style) instead of VinylDisc (circular)
- Cards show genre badge, year, and album title overlaid on art area
- Drag-and-drop still works (pointer events intact via wrapper div)
- Shake animation on incorrect drop preserved via CSS class
- TypeScript clean, build succeeds
- User visually approves: HUD, VinylCard sleeve form, shelf recessed state, sparkle effect
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-ui-components/02-08-SUMMARY.md`
</output>
