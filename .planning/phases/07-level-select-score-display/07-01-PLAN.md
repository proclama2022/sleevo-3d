---
phase: 07-level-select-score-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/LevelSelect/LevelSelect.tsx
  - src/components/LevelSelect/LevelSelect.module.css
autonomous: false
requirements:
  - SELECT-01

must_haves:
  truths:
    - "Each unlocked completed level cell shows the best score as 'X.XXX pt' below the stars"
    - "Each unlocked level that has never been completed shows 'â€”' below the stars"
    - "Locked level cells show no score value (no em dash, no '0 pt')"
    - "Score format matches formatScore utility â€” Italian thousand separator, em dash for undefined"
  artifacts:
    - path: "src/components/LevelSelect/LevelSelect.tsx"
      provides: "LevelCell with bestScore prop and conditional score row"
      contains: "formatScore(bestScore)"
    - path: "src/components/LevelSelect/LevelSelect.module.css"
      provides: ".score CSS class for score row"
      contains: ".score"
  key_links:
    - from: "LevelSelect map loop"
      to: "LevelCell.bestScore prop"
      via: "p?.bestScore extracted from loadAllProgress() result"
      pattern: "bestScore = p\\?\\.bestScore"
    - from: "LevelCell render"
      to: "formatScore utility"
      via: "import from ../../utils (barrel)"
      pattern: "import.*formatScore.*from.*utils"
    - from: "score span"
      to: "unlocked guard"
      via: "{unlocked && (<span ...>)}"
      pattern: "unlocked &&"
---

<objective>
Add best score display to each LevelCell in the level select grid.

Purpose: Players can compare their personal best scores across all levels at a glance. This is the final v1.1 Social & Retention feature â€” completing the milestone goal.
Output: Two files modified. LevelCell gains an optional bestScore prop rendered as "X.XXX pt" (completed) or "â€”" (never completed) for unlocked cells only. Locked cells remain unchanged.
</objective>

<execution_context>
@/Users/martha2022/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martha2022/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-level-select-score-display/07-RESEARCH.md
@src/components/LevelSelect/LevelSelect.tsx
@src/components/LevelSelect/LevelSelect.module.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bestScore prop and score row to LevelCell</name>
  <files>
    src/components/LevelSelect/LevelSelect.tsx
    src/components/LevelSelect/LevelSelect.module.css
  </files>
  <action>
**LevelSelect.tsx â€” four changes:**

1. Add import at the top of the file (after the existing imports):
   ```typescript
   import { formatScore } from '../../utils';
   ```

2. Extend `CellProps` interface â€” add `bestScore?: number` after `bestStars`:
   ```typescript
   interface CellProps {
     levelNumber: number;
     bestStars: number;
     bestScore?: number;        // undefined means never completed
     unlocked: boolean;
     focused: boolean;
     onClick: () => void;
     cellRef?: React.Ref<HTMLButtonElement>;
   }
   ```

3. Update `LevelCell` function signature and render â€” add `bestScore` to destructured props, add score span after the stars div, before the lock span:
   ```typescript
   function LevelCell({ levelNumber, bestStars, bestScore, unlocked, focused, onClick, cellRef }: CellProps) {
     return (
       <button ...>
         <span className={styles.number}>{levelNumber}</span>
         <div className={styles.stars}>
           {[1, 2, 3].map(n => (
             <span key={n} className={`${styles.star} ${n <= bestStars ? styles.starFilled : styles.starEmpty}`}>
               â˜…
             </span>
           ))}
         </div>
         {unlocked && (
           <span className={styles.score}>{formatScore(bestScore)}</span>
         )}
         {!unlocked && <span className={styles.lock}>ðŸ”’</span>}
       </button>
     );
   }
   ```
   CRITICAL: The score span is only rendered when `unlocked === true`. Locked cells must show nothing â€” not "â€”", not "0 pt". The `unlocked &&` guard is mandatory.
   CRITICAL: Do NOT write `bestScore !== undefined ? formatScore(bestScore) : 'â€”'`. Use `formatScore(bestScore)` directly â€” it already returns 'â€”' for undefined.
   CRITICAL: Import from `../../utils` (the barrel), not `../../utils/formatScore` directly.

4. In the `LevelSelect` map loop, extract `bestScore` from `p` and pass it to `LevelCell`:
   ```typescript
   const p = progress[level.id];
   const bestStars = p?.stars ?? 0;
   const bestScore = p?.bestScore;   // undefined if level never completed
   const unlocked = isLevelUnlocked(index, LEVELS);
   const isFocused = index === currentFocusIndex;

   return (
     <LevelCell
       key={level.id}
       levelNumber={index + 1}
       bestStars={bestStars}
       bestScore={bestScore}
       unlocked={unlocked}
       focused={isFocused}
       onClick={() => onSelectLevel(index)}
       cellRef={isFocused ? focusedCellRef : undefined}
     />
   );
   ```
   Do NOT add an additional `loadAllProgress()` call inside LevelCell. The parent's single call covers all cells.

**LevelSelect.module.css â€” two changes:**

1. Reduce `.cell` gap from `4px` to `2px` to prevent the fourth row (score) from overflowing the `aspect-ratio: 1` constraint:
   ```css
   .cell {
     /* ... existing rules ... */
     gap: 2px;   /* reduced from 4px to accommodate score row */
   }
   ```

2. Add `.score` class at the end of the file (after `.lock`):
   ```css
   .score {
     font-size: 10px;
     color: rgba(255, 200, 120, 0.6);
     line-height: 1;
     letter-spacing: 0.02em;
   }
   ```
   Use `font-size: 10px` (smaller than the `.hint` at 11px) to minimize height impact on the cell.
  </action>
  <verify>
    <automated>cd /Users/martha2022/Documents/Sleevo && npx tsc --noEmit 2>&1 | head -20</automated>
    <manual>TypeScript compiles with zero errors. Both files are modified. The formatScore import is from '../../utils' (not '../../utils/formatScore').</manual>
    <sampling_rate>run after this task, before checkpoint</sampling_rate>
  </verify>
  <done>TypeScript compiles with zero errors. LevelCell accepts bestScore prop. Score span renders only when unlocked is true. formatScore is imported from the utils barrel.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify score display in level select grid</name>
  <action>Human verification â€” no automated action. Run `npm run dev` and visually confirm the score display per the steps below.</action>
  <verify>
    <automated>cd /Users/martha2022/Documents/Sleevo && npx tsc --noEmit 2>&1 | head -5</automated>
    <manual>
      1. Run the dev server: `npm run dev` in /Users/martha2022/Documents/Sleevo
      2. Open http://localhost:5173 and navigate to the level select screen
      3. COMPLETED level cell: shows "X.XXX pt" below the three star icons (e.g. "1.420 pt" with Italian dot separator)
      4. UNLOCKED but NEVER COMPLETED level cell: shows "â€”" (em dash) below the stars â€” not "0 pt", not empty
      5. LOCKED level cell: shows ONLY the lock emoji â€” no score, no em dash
      6. Cell layout is square (aspect-ratio 1:1) â€” score text not clipped, cells not rectangular
      7. If no saved scores exist: complete level 1, return to level select, verify "X.XXX pt" appears
    </manual>
  </verify>
  <done>User confirms: correct score shown on completed cells, em dash on unlocked/never-completed cells, no score on locked cells, layout remains square.</done>
</task>

</tasks>

<verification>
TypeScript compiles with zero errors: `npx tsc --noEmit`
Level select grid shows scores correctly:
- Completed unlocked cells: "X.XXX pt" (Italian format)
- Unlocked never-completed cells: "â€”" (em dash)
- Locked cells: lock icon only, no score
Cell layout remains square (aspect-ratio: 1 preserved)
formatScore import uses barrel path: `../../utils`
</verification>

<success_criteria>
SELECT-01 satisfied: Each completed level cell shows the best score as "X.XXX pt" below the stars; shows "â€”" if the level was never completed; locked cells show no score at all. The format is consistent with the formatScore utility (it-IT locale, em dash for undefined).
</success_criteria>

<output>
After completion, create `.planning/phases/07-level-select-score-display/07-01-SUMMARY.md` following the summary template at @/Users/martha2022/.claude/get-shit-done/templates/summary.md
</output>
