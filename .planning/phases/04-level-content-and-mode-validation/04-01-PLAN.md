---
phase: 04-level-content-and-mode-validation
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/game/types.ts
  - src/game/levels.ts
autonomous: true
requirements:
  - LVLS-01
  - LVLS-02
  - LVLS-03
  - LVLS-04

must_haves:
  truths:
    - "The Level interface has rushTime (not timeLimit), customerName, and no stale fields"
    - "All 21 levels compile with the updated type — no TypeScript errors"
    - "Level 1 has 4 vinyls (down from 6)"
    - "The 5 customer-mode levels each have a customerName field set"
    - "Blackout levels (5, 13) no longer carry a timeLimit/rushTime field"
    - "levels.ts exports 21 levels covering all 7 modes"
  artifacts:
    - path: "src/game/types.ts"
      provides: "Level interface with rushTime, customerName; GameState with blackoutSecondsLeft"
      contains: "rushTime"
    - path: "src/game/levels.ts"
      provides: "21 level definitions with customerName on customer-mode levels"
      contains: "customerName"
  key_links:
    - from: "src/game/types.ts"
      to: "src/game/engine.ts"
      via: "Level.rushTime used in createGameState rushTimeLeft"
      pattern: "rushTime"
    - from: "src/game/types.ts"
      to: "src/game/levels.ts"
      via: "Level interface shape"
      pattern: "customerName"
---

<objective>
Update the data foundation for Phase 4: rename the `timeLimit` field to `rushTime` in the Level type, add `customerName?: string` to Level, add `blackoutSecondsLeft: number` to GameState, fix level 1 vinyl count from 6 to 4, add customerName to all 5 customer-mode levels, and remove the stale timeLimit field from blackout levels 5 and 13.

Purpose: All subsequent plans (engine fix, UI components, GameScreen wiring) depend on this consistent type layer. Getting types right first prevents cascading TypeScript errors downstream.

Output: Updated src/game/types.ts and src/game/levels.ts — no UI changes, only the data model.
</objective>

<execution_context>
@/Users/martha2022/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martha2022/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-level-content-and-mode-validation/04-CONTEXT.md
@.planning/phases/04-level-content-and-mode-validation/04-RESEARCH.md
@src/game/types.ts
@src/game/levels.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Level interface and GameState in types.ts</name>
  <files>src/game/types.ts</files>
  <action>
Make the following targeted edits to src/game/types.ts:

1. In the `Level` interface:
   - Replace `timeLimit?: number;` with `rushTime?: number;  // rush mode countdown seconds`
   - Add after the `hint?: string;` line: `customerName?: string;  // Italian name displayed in CustomerPanel (customer mode)`

2. In the `GameState` interface, add a new field in the blackout section:
   - After the line `labelsVisible: boolean;` add: `blackoutSecondsLeft: number;  // countdown before labels hide; 0 = already hidden or not blackout mode`

Do NOT change any other fields. Do NOT touch SortRule, LevelMode, or any other interface. The `sleeveTargets` field stays as-is.
  </action>
  <verify>
    <automated>cd /Users/martha2022/Documents/Sleevo && npx tsc --noEmit 2>&1 | head -30</automated>
    <manual>Confirm types.ts has rushTime (not timeLimit), customerName, and blackoutSecondsLeft in the correct interfaces</manual>
    <sampling_rate>run after this task before proceeding</sampling_rate>
  </verify>
  <done>TypeScript compiler reports errors only from files that still reference `timeLimit` (engine.ts, levels.ts — expected at this stage). types.ts itself has no errors. rushTime, customerName, and blackoutSecondsLeft all appear in the type definitions.</done>
</task>

<task type="auto">
  <name>Task 2: Update levels.ts — rename timeLimit, add customerName, fix level 1 count</name>
  <files>src/game/levels.ts</files>
  <action>
Make the following targeted edits to src/game/levels.ts:

**Step 1 — Rename timeLimit to rushTime on rush-mode levels only:**
Find all occurrences of `timeLimit:` in rush-mode levels (levels 8, 14, 17) and rename each to `rushTime:`. Levels 8, 14, 17 are the only levels with `mode: 'rush'`.

**Step 2 — Remove timeLimit from blackout levels:**
Levels 5 and 13 are `mode: 'blackout'` and currently have `timeLimit: 90` and `timeLimit: 120` respectively. Remove these `timeLimit` lines entirely from levels 5 and 13. These are unused artifacts — the blackout timer will be handled by the engine's `blackoutSecondsLeft` countdown, not a level-defined field.

**Step 3 — Add customerName to the 5 customer-mode levels:**
Add `customerName: 'NAME',` to each customer-mode level immediately after the `mode: 'customer'` line. Use these Italian names (Claude's discretion per CONTEXT.md):
- Level 4 (id: 'level-4'): customerName: 'Marco'
- Level 7 (id: 'level-7'): customerName: 'Sofia'
- Level 12 (id: 'level-12'): customerName: 'Luca'
- Level 16 (id: 'level-16'): customerName: 'Elena'
- Level 20 (id: 'level-20'): customerName: 'Giovanni'

**Step 4 — Fix level 1 vinyl count from 6 to 4:**
Level 1 (id: 'level-1') currently has 6 vinyls. Remove the last 2 vinyl entries from its `vinyls` array to leave exactly 4. Keep the first 4 vinyls as-is. Also update the `parTime` for level 1 if it uses the formula (vinyls × 3s) × mode_multiplier: 4 × 3 × 1.0 = 12 seconds. If the existing parTime is already a manually set value, use 15 to give a more comfortable par for beginners.
  </action>
  <verify>
    <automated>cd /Users/martha2022/Documents/Sleevo && npx tsc --noEmit 2>&1 | head -30</automated>
    <manual>Confirm no `timeLimit` field remains anywhere in levels.ts; levels 8/14/17 have `rushTime`; levels 4/7/12/16/20 have `customerName`; level 1 has exactly 4 vinyls in its vinyls array</manual>
    <sampling_rate>run after this task — must be clean compile before plan 03 proceeds</sampling_rate>
  </verify>
  <done>TypeScript compiler shows zero errors. grep for `timeLimit` in src/game/levels.ts returns no results. All 5 customer-mode levels have customerName. Level 1 has 4 vinyls. 21 levels total remain in the export.</done>
</task>

</tasks>

<verification>
Run: `cd /Users/martha2022/Documents/Sleevo && npx tsc --noEmit`
Expected: zero errors.

Run: `grep -n "timeLimit" /Users/martha2022/Documents/Sleevo/src/game/levels.ts`
Expected: no output (all timeLimit occurrences removed or renamed).

Run: `grep -n "customerName" /Users/martha2022/Documents/Sleevo/src/game/levels.ts`
Expected: 5 lines (one per customer-mode level).

Run: `grep -c "id:" /Users/martha2022/Documents/Sleevo/src/game/levels.ts`
Expected: count consistent with 21 levels (21 id fields).
</verification>

<success_criteria>
- types.ts: Level has rushTime (not timeLimit), customerName, GameState has blackoutSecondsLeft
- levels.ts: No `timeLimit` field anywhere; rush levels use `rushTime`; 5 customer levels have `customerName`; level 1 has 4 vinyls; 21 levels total
- TypeScript compiles clean (engine.ts will have errors on timeLimit references — those are fixed in Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/04-level-content-and-mode-validation/04-01-SUMMARY.md`
</output>
