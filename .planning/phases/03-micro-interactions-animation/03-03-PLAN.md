---
phase: 03-micro-interactions-animation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/animations/keyframes.ts
  - src/components/VinylCard/VinylCard.tsx
  - src/components/ShelfSlot/ShelfSlot.tsx
autonomous: false
requirements:
  - MOTION-02

must_haves:
  truths:
    - "Shake animation duration is 150ms (measured via DevTools Performance tab)"
    - "Shake keyframes produce 2-3 oscillations (left-right-left-right pattern)"
    - "Shake animation applies to VinylCard when placement is invalid"
    - "Shake animation applies to ShelfSlot when placement is invalid"
    - "Player can drag again immediately after shake completes (no blocking delay)"
  artifacts:
    - path: "src/animations/keyframes.ts"
      provides: "Updated shake keyframe animation with faster timing"
      exports: ["shake", "animations"]
      min_lines: 15
  key_links:
    - from: "src/components/VinylCard/VinylCard.tsx"
      to: "src/animations/keyframes.ts"
      via: "import statement"
      pattern: "from '\\.\\.\\/animations'"
    - from: "src/components/ShelfSlot/ShelfSlot.tsx"
      to: "src/animations/keyframes.ts"
      via: "import statement"
      pattern: "from '\\.\\.\\/animations'"
---

# Plan 03-03: Shake Animation Speed-Up

**Goal:** Speed up shake animation from 400ms → 150ms for snappier wrong placement feedback.

**User Decision from 03-CONTEXT.md:**
> "Wrong shake intensity: Fast shake (150ms) — quick shake, 2-3 oscillations, feels snappy"

**Requirements Satisfied:** MOTION-02 (Card drop animation with Material easing)

**Current State:**
- Shake duration: 400ms (too slow)
- Shake keyframes: 5 oscillations (0%, 10%, 20%, ... 90%, 100%)
- Applied to: VinylCard wrapper and ShelfSlot

**Target State:**
- Shake duration: 150ms (fast, responsive)
- Shake keyframes: 2-3 oscillations (snappy)
- Same components affected

---

<task type="auto">
  <name>Task 1: Update Shake Keyframe Duration</name>
  <files>src/animations/keyframes.ts</files>
  <action>
Find the shake animation mixin. Update duration from 400ms to 150ms:
```typescript
shake: css`
  animation: ${shake} 150ms ${EASING.STANDARD};
`,
```
Per user decision from 03-CONTEXT.md: "Wrong shake intensity: Fast shake (150ms) — quick shake, 2-3 oscillations, feels snappy"
</action>
  <verify>Duration is now 150ms (was 400ms). Keyframe animation not affected (only timing changes).</verify>
  <done>Shake animation duration reduced to 150ms for snappier feel</done>
</task>

<task type="auto">
  <name>Task 2: Reduce Shake Oscillations to 2-3</name>
  <files>src/animations/keyframes.ts</files>
  <action>
Update shake keyframes from 5 oscillations to 3 oscillations:
```typescript
export const shake = keyframes`
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-4px); }
  40%, 80% { transform: translateX(4px); }
`;
```
This produces: 0ms start, 30ms left, 60ms right, 90ms left, 120ms right, 150ms end. Total 3 oscillations with ±4px distance.
</action>
  <verify>Keyframes have 3 oscillations (left-right-left-right pattern). Ends at neutral position (translateX(0)). Distance remains ±4px.</verify>
  <done>Shake reduced to 2-3 oscillations for snappier feel</done>
</task>

<task type="auto">
  <name>Task 3: Verify Shake in VinylCard Component</name>
  <files>src/components/VinylCard/VinylCard.tsx</files>
  <action>
Verify shake animation is correctly wired. Shake should apply when state is 'placed' AND isValid is false via:
```typescript
${(props) => {
  if (props.$isAnimating && props.$state === 'placed') {
    if (props.$isValid) {
      return css`${animations.cardSettle}`;
    } else {
      return css`${animations.shake}`;
    }
  }
  return css``;
}}
```
No changes needed if already correctly implemented. Component inherits new 150ms timing from animations.shake mixin.
</action>
  <verify>Shake animation applies when state === 'placed' AND isValid === false. Inherits new 150ms timing from animations.shake mixin.</verify>
  <done>Shake animation verified in VinylCard (no changes needed if already wired)</done>
</task>

<task type="auto">
  <name>Task 4: Fix Shake Duration in ShelfSlot Component</name>
  <files>src/components/ShelfSlot/ShelfSlot.tsx</files>
  <action>
Find the inline shake animation in invalid state. Update from 400ms to 150ms:
```typescript
${(props) => props.$state === 'invalid' && css`
  background: linear-gradient(180deg, rgba(58, 18, 12, 0.9) 0%, rgba(32, 10, 8, 0.95) 100%);
  box-shadow: 0 0 20px rgba(239, 68, 68, 0.6), 0 0 40px rgba(239, 68, 68, 0.3);
  animation: shake 150ms ease-in-out, invalidPulse 700ms ease-in-out;
`}
```
The inline shake 400ms overrides the animation mixin, so this must be updated to 150ms. invalidPulse remains 700ms as separate feedback.
</action>
  <verify>Inline shake animation is now 150ms (was 400ms). invalidPulse animation remains 700ms. Both animations run in parallel (comma-separated).</verify>
  <done>Shake duration fixed in ShelfSlot to match keyframe timing</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Shake animation speed-up: duration 150ms (down from 400ms) with 2-3 oscillations</what-built>
  <how-to-verify>
1. Place vinyl incorrectly → verify shake completes in ~150ms
2. Count oscillations → verify 2-3 shakes (not 5)
3. Test on mobile → verify shake feels responsive, not sluggish
4. Enable reduced motion → verify shake is skipped
5. Verify shake doesn't block retry (can immediately drag again)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

**Manual Testing Required:**

1. **iOS Safari (iPhone):**
   - Place vinyl incorrectly → observe shake speed
   - Verify shake feels responsive, not sluggish
   - Check for frame drops during shake

2. **Android Chrome:**
   - Same test as iOS
   - Verify consistent timing across devices

3. **Low-end device testing:**
   - Enable Chrome DevTools CPU throttling (4x slowdown)
   - Verify shake still completes in ~150ms

**Acceptance Criteria:**
- Shake feels snappy and responsive
- No visible lag between placement and shake
- Animation completes quickly (player can retry immediately)

---

## Success Criteria

- [ ] Shake animation duration is 150ms (down from 400ms)
- [ ] Shake has 2-3 oscillations (not 5)
- [ ] Shake feels fast and snappy on mobile
- [ ] Both VinylCard and ShelfSlot use consistent timing
- [ ] Reduced motion mode disables shake animation

---

## Testing Checklist

- [ ] Place vinyl incorrectly → verify shake completes in ~150ms
- [ ] Count oscillations → verify 2-3 shakes (not 5)
- [ ] Test on iOS Safari → verify responsive feel
- [ ] Test on Android Chrome → verify consistent timing
- [ ] Enable reduced motion → verify shake is skipped
- [ ] Verify shake doesn't block retry (can immediately drag again)

---

## Files Modified

- `src/animations/keyframes.ts` - Update shake duration (400ms → 150ms) and reduce oscillations
- `src/components/VinylCard/VinylCard.tsx` - No changes needed (inherits from mixin)
- `src/components/ShelfSlot/ShelfSlot.tsx` - Update inline shake duration to match

---

## Dependencies

**Depends on:** None (independent change)

**Blocks:** None (pure polish, no downstream effects)

## Phase

**Phase:** 03-micro-interactions-animation
**Plan:** 03
**Type:** execute

---

## Notes

- Shake animation is CSS-only (no JS overhead)
- Reduced motion support already in place via `reducedMotion` mixin
- 150ms is fast enough to feel snappy but slow enough to be visible
- 2-3 oscillations provide clear feedback without feeling "jittery"
