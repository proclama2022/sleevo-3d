---
phase: 03-micro-interactions-animation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ParticleBurst/ParticleBurst.tsx
  - src/components/ParticleBurst/Particle.tsx
  - src/components/ParticleBurst/index.ts
  - src/components/ShelfSlot/ShelfSlot.tsx
autonomous: true
requirements:
  - MOTION-04

must_haves:
  truths:
    - "User sees particles burst outward from slot center on correct placement"
    - "User sees 8-12 particles radiating in all directions"
    - "User sees particles fade out over ~600ms"
    - "User sees particles coordinate with sparkle (both visible)"
    - "User sees NO particles on invalid placement"
  artifacts:
    - path: "src/components/ParticleBurst/Particle.tsx"
      provides: "Single particle with radial animation"
      exports: ["Particle", "ParticleProps"]
      min_lines: 50
    - path: "src/components/ParticleBurst/ParticleBurst.tsx"
      provides: "Particle burst container managing multiple particles"
      exports: ["ParticleBurst", "ParticleBurstProps"]
      min_lines: 80
    - path: "src/components/ParticleBurst/index.ts"
      provides: "Barrel export for particle components"
      exports: ["ParticleBurst", "Particle"]
      min_lines: 3
  key_links:
    - from: "src/components/ShelfSlot/ShelfSlot.tsx"
      to: "src/components/ParticleBurst/ParticleBurst.tsx"
      via: "component import"
      pattern: "import.*ParticleBurst"
---

# Plan 03-02: Particle Burst System

**Goal:** Add celebration burst on correct vinyl placement with particles radiating outward.

**User Decision from 03-CONTEXT.md:**
> "Correct placement: Medium celebration — burst effect with particles radiating outward + existing sparkle animation"

**Requirements Satisfied:** MOTION-04 (Score increment celebrates points earned)

**Note:** MOTION-04's requirement text mentions "Number count up, scale pulse" for score animation, which refers to the existing score counter animation. This plan implements a separate particle burst celebration that coordinates with the existing sparkle animation (per user decision). The particle burst is an additional visual feedback element, not the primary score counter animation.

**Design Decisions:**
- Particle count: 8-12 particles per burst (Claude's discretion)
- Particle color: Gold/yellow (`#ffd700`) to match celebration feel
- Particle shape: Small circles (4px-8px) with fade-out
- Burst pattern: Radial explosion from slot center
- Duration: 600ms total (matches combo popup timing)

---

<task type="auto">
  <name>Task 1: Create Particle Component</name>
  <files>src/components/ParticleBurst/Particle.tsx</files>
  <action>
Create single particle component with animation. Implementation:
```typescript
import React from 'react';
import styled, { keyframes } from 'styled-components';
import { reducedMotion } from '../../animations';

export interface ParticleProps {
  angle: number; // Direction in degrees (0-360)
  distance: number; // How far to travel (px)
  size: number; // Particle size (px)
  delay: number; // Animation delay (ms)
  color?: string; // Particle color
}

const burstAnim = keyframes`
  0% { transform: translate(0, 0) scale(1); opacity: 1; }
  100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
`;

const ParticleWrapper = styled.div<{
  $angle: number;
  $distance: number;
  $size: number;
  $delay: number;
  $color: string;
}>`
  position: absolute;
  width: ${(props) => props.$size}px;
  height: ${(props) => props.$size}px;
  background: ${(props) => props.$color};
  border-radius: 50%;
  pointer-events: none;
  opacity: 0;
  --tx: ${(props) => Math.cos((props.$angle * Math.PI) / 180) * props.$distance}px;
  --ty: ${(props) => Math.sin((props.$angle * Math.PI) / 180) * props.$distance}px;
  animation: ${burstAnim} 600ms ease-out forwards;
  animation-delay: ${(props) => props.$delay}ms;
  ${reducedMotion}
`;

export const Particle: React.FC<ParticleProps> = ({
  angle, distance, size, delay, color = '#ffd700'
}) => (
  <ParticleWrapper
    $angle={angle} $distance={distance} $size={size}
    $delay={delay} $color={color}
    aria-hidden="true"
  />
);
```
Per user decision from 03-CONTEXT.md: "Correct placement: Medium celebration — burst effect with particles radiating outward"
</action>
  <verify>File exists at src/components/ParticleBurst/Particle.tsx with ParticleProps interface and Particle component. CSS variables --tx and --ty calculate destination using trigonometry. Animation uses 600ms duration with ease-out.</verify>
  <done>Particle component created with radial animation and reduced motion support</done>
</task>

<task type="auto">
  <name>Task 2: Create ParticleBurst Component</name>
  <files>src/components/ParticleBurst/ParticleBurst.tsx</files>
  <action>
Create particle burst container managing multiple particles. Implementation:
```typescript
import React from 'react';
import styled from 'styled-components';
import { Particle } from './Particle';

export interface ParticleBurstProps {
  x: number; // Center X position
  y: number; // Center Y position
  count?: number; // Number of particles (default: 10)
  size?: { min: number; max: number };
  distance?: { min: number; max: number };
  color?: string;
  onComplete?: () => void;
}

const BurstContainer = styled.div<{ $x: number; $y: number }>`
  position: fixed;
  top: ${(props) => props.$y}px;
  left: ${(props) => props.$x}px;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 100;
  width: 0;
  height: 0;
`;

export const ParticleBurst: React.FC<ParticleBurstProps> = ({
  x, y, count = 10,
  size = { min: 4, max: 8 },
  distance = { min: 40, max: 80 },
  color = '#ffd700',
  onComplete
}) => {
  const particles = React.useMemo(() =>
    Array.from({ length: count }, (_, i) => ({
      id: `particle-${i}`,
      angle: (360 / count) * i,
      distance: distance.min + Math.random() * (distance.max - distance.min),
      size: size.min + Math.random() * (size.max - size.min),
      delay: Math.random() * 50
    })), [count, distance, size]);

  React.useEffect(() => {
    const timer = setTimeout(() => onComplete?.(), 650);
    return () => clearTimeout(timer);
  }, [onComplete]);

  return (
    <BurstContainer $x={x} $y={y} aria-hidden="true">
      {particles.map((p) => (
        <Particle key={p.id} angle={p.angle} distance={p.distance}
                  size={p.size} delay={p.delay} color={color} />
      ))}
    </BurstContainer>
  );
};
```
</action>
  <verify>File exists at src/components/ParticleBurst/ParticleBurst.tsx with ParticleBurstProps interface. Component generates random particles with varied properties (angle, distance, size, delay).</verify>
  <done>ParticleBurst component created with radial burst pattern and auto-cleanup</done>
</task>

<task type="auto">
  <name>Task 3: Create Barrel Export</name>
  <files>src/components/ParticleBurst/index.ts</files>
  <action>
Create barrel export for particle components:
```typescript
export { ParticleBurst } from './ParticleBurst';
export { Particle } from './Particle';
export type { ParticleBurstProps, ParticleProps } from './ParticleBurst';
```
</action>
  <verify>File exists at src/components/ParticleBurst/index.ts with exports for ParticleBurst, Particle, and their props types.</verify>
  <done>Barrel export created for particle components</done>
</task>

<task type="auto">
  <name>Task 4: Integrate ParticleBurst in ShelfSlot</name>
  <files>src/components/ShelfSlot/ShelfSlot.tsx</files>
  <action>
Import ParticleBurst component. Add state for particle burst:
```typescript
const [showParticles, setShowParticles] = useState(false);
const [particlePosition, setParticlePosition] = useState<{x: number, y: number} | null>(null);
```

Trigger particle burst on valid placement in useEffect. When state becomes 'filled' and placedVinylId exists:
1. Get slot rect via slotRef.current?.getBoundingClientRect()
2. Calculate center coordinates: x = rect.left + rect.width / 2, y = rect.top + rect.height / 2
3. Set particlePosition and setShowParticles(true)
4. Set 600ms timer to reset state

Render ParticleBurst conditionally:
```typescript
{showParticles && particlePosition && (
  <ParticleBurst
    x={particlePosition.x}
    y={particlePosition.y}
    count={10}
    color="#ffd700"
    onComplete={() => setShowParticles(false)}
  />
)}
```

Per user decision from 03-CONTEXT.md: "Correct placement: Medium celebration — burst effect with particles radiating outward + existing sparkle animation"
</action>
  <verify>ShelfSlot imports ParticleBurst. State added for showParticles and particlePosition. useEffect triggers burst on filled state with getBoundingClientRect() for coordinates. ParticleBurst rendered with position props.</verify>
  <done>ParticleBurst integrated in ShelfSlot with slot center positioning</done>
</task>

<task type="auto">
  <name>Task 5: Add Combo Milestone Bursts in GameScreen</name>
  <files>src/components/GameScreen.tsx</files>
  <action>
Track combo milestones in GameScreen state:
```typescript
const [comboBurst, setComboBurst] = useState<{x: number, y: number} | null>(null);
const previousComboRef = useRef(0);
```

In useEffect watching state.combo.streak, trigger burst at milestones (5x, 8x, 10x):
```typescript
useEffect(() => {
  const prevCombo = previousComboRef.current;
  const currentCombo = state.combo.streak;
  if (currentCombo >= 5 && prevCombo < 5) setComboBurst(lastSlotPosition);
  else if (currentCombo >= 8 && prevCombo < 8) setComboBurst(lastSlotPosition);
  else if (currentCombo >= 10 && prevCombo < 10) setComboBurst(lastSlotPosition);
  previousComboRef.current = currentCombo;
}, [state.combo.streak, lastSlotPosition]);
```

Note: lastSlotPosition state must exist from 03-01 plan. If not present, add it per Task 5 in 03-01.

Render larger burst for milestones:
```typescript
{comboBurst && (
  <ParticleBurst
    x={comboBurst.x}
    y={comboBurst.y}
    count={15}
    distance={{ min: 60, max: 100 }}
    color="#fbbf24"
    onComplete={() => setComboBurst(null)}
  />
)}
```
</action>
  <verify>GameScreen has comboBurst state. useEffect tracks combo milestones at 5x, 8x, 10x. Larger burst rendered with 15 particles, increased distance (60-100px), and gold-amber color (#fbbf24).</verify>
  <done>Combo milestone bursts added with larger particle count and travel distance</done>
</task>

---

## Success Criteria

- [ ] Particle burst appears on correct vinyl placement
- [ ] Particles radiate outward from slot center in all directions
- [ ] 8-12 particles per burst with random sizes/distances
- [ ] Burst duration ~600ms with fade-out
- [ ] Coordinates with existing sparkle animation (both visible)
- [ ] No particles on invalid placement
- [ ] Reduced motion mode disables particle animation

---

## Testing Checklist

- [ ] Place vinyl correctly → verify particles burst outward
- [ ] Place vinyl incorrectly → verify NO particles appear
- [ ] Verify particles don't block interactions (pointer-events: none)
- [ ] Test at screen edges → verify particles don't cause overflow
- [ ] Enable reduced motion → verify particles appear instantly or not at all
- [ ] Place multiple vinyls quickly → verify no performance issues
- [ ] Verify particle cleanup (no DOM accumulation)

---

## Files Created

- `src/components/ParticleBurst/Particle.tsx` - Single particle with animation
- `src/components/ParticleBurst/ParticleBurst.tsx` - Burst container with multiple particles
- `src/components/ParticleBurst/index.ts` - Barrel export

## Files Modified

- `src/components/ShelfSlot/ShelfSlot.tsx` - Integrate particle burst on valid placement
- `src/components/GameScreen.tsx` - Optional: larger burst for combo milestones

---

## Dependencies

**Depends on:** None (can run in parallel with 03-01, positioning logic independent)

**Blocks:** None (independent feature)

## Phase

**Phase:** 03-micro-interactions-animation
**Plan:** 02
**Type:** execute

---

## Notes

- Particle count is Claude's discretion within 8-12 range
- Gold color (`#ffd700`) matches celebration/combo aesthetic
- CSS trigonometry (`calc()` with cos/sin) enables radial burst without JS position calculation
- Auto-cleanup via `onComplete` callback prevents memory leaks
