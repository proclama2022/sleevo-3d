---
phase: 03-progression-and-navigation
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/LevelSelect/LevelSelect.tsx
  - src/components/LevelSelect/LevelSelect.module.css
autonomous: true
requirements:
  - PROG-03

must_haves:
  truths:
    - "A level select screen renders all levels in a 3-column grid"
    - "Each cell shows level number and best star count (filled/empty stars)"
    - "Locked cells appear dimmed with a padlock icon; tapping them does nothing"
    - "The focused cell (first incomplete level) is visually highlighted"
    - "The focused cell scrolls into view after mount"
    - "A hint text below the grid explains the 2-star unlock rule"
  artifacts:
    - path: "src/components/LevelSelect/LevelSelect.tsx"
      provides: "LevelSelect screen component with LevelCell sub-component"
      exports: ["LevelSelect"]
      min_lines: 60
    - path: "src/components/LevelSelect/LevelSelect.module.css"
      provides: "Grid layout, cell styles, locked/focused state via data attributes"
      contains: "grid-template-columns: repeat(3, 1fr)"
  key_links:
    - from: "src/components/LevelSelect/LevelSelect.tsx"
      to: "src/game/storage.ts"
      via: "loadAllProgress() called directly in component body (synchronous read)"
      pattern: "loadAllProgress\\(\\)"
    - from: "src/components/LevelSelect/LevelSelect.tsx"
      to: "src/game/storage.ts"
      via: "isLevelUnlocked(index, LEVELS) for each cell"
      pattern: "isLevelUnlocked"
    - from: "src/components/LevelSelect/LevelSelect.tsx"
      to: "src/game/levels.ts"
      via: "LEVELS array imported directly (not passed as prop)"
      pattern: "import.*LEVELS"
---

<objective>
Build the LevelSelect component: a full-screen level grid where players choose a level to play.

Purpose: Players need a way to see all available levels, their progress, and which levels they have unlocked before entering gameplay. This is the hub the game opens on after Phase 3 wiring.
Output: src/components/LevelSelect/LevelSelect.tsx and LevelSelect.module.css â€” a standalone, self-contained component ready to be imported by App.tsx in Plan 02.
</objective>

<execution_context>
@/Users/martha2022/.claude/get-shit-done/workflows/execute-plan.md
@/Users/martha2022/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-progression-and-navigation/03-CONTEXT.md
@.planning/phases/03-progression-and-navigation/03-RESEARCH.md

@src/game/storage.ts
@src/game/levels.ts
@src/components/GameScreen.module.css
@src/styles/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: LevelSelect component with 3-column grid</name>
  <files>src/components/LevelSelect/LevelSelect.tsx</files>
  <action>
Create src/components/LevelSelect/LevelSelect.tsx.

The component accepts two props:
```typescript
interface Props {
  onSelectLevel: (index: number) => void;
  currentFocusIndex: number; // index of cell to highlight on load
}
```

Implementation details:
- Import `loadAllProgress`, `isLevelUnlocked` from `../../game/storage`
- Import `LEVELS` from `../../game/levels` (NOT as prop â€” module constant)
- Import `useRef`, `useEffect` from react
- Call `loadAllProgress()` directly in component body (synchronous â€” no useEffect, no useState for progress)
- Render a full-screen viewport wrapper â†’ a card shell â†’ header â†’ grid â†’ hint text
- Header: `<h1>` with text "Scegli Livello" â€” no back button yet (App.tsx will handle navigation)
- Grid: map over `LEVELS`, for each produce a `LevelCell` (inline function or separate function in same file)
- After grid: `<p>` with text "Guadagna 2 stelle per sbloccare il prossimo livello"

LevelCell sub-component (inline in same file, NOT exported):
```typescript
interface CellProps {
  levelNumber: number;   // 1-based display number
  bestStars: number;     // 0-3
  unlocked: boolean;
  focused: boolean;
  onClick: () => void;
  cellRef?: React.Ref<HTMLButtonElement>;
}
```
- Render `<button>` with `data-unlocked={String(unlocked)}` and `data-focused={String(focused)}`
- `disabled={!unlocked}` for accessibility
- `aria-label={`Livello ${levelNumber}${!unlocked ? ', bloccato' : ''}`}`
- Inside: `<span>` with level number, `<div>` with 3 star spans (filled if n <= bestStars, empty class otherwise), and if locked a `<span>` with text "ðŸ”’"
- Star spans: className `${styles.star} ${n <= bestStars ? styles.starFilled : styles.starEmpty}`

ScrollIntoView for focused cell:
- `const focusedCellRef = useRef<HTMLButtonElement>(null)`
- Pass `cellRef={focusedCellRef}` to the cell where `index === currentFocusIndex`
- `useEffect(() => { focusedCellRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, [])` â€” runs once on mount

Locked level click: `disabled={!unlocked}` plus `pointer-events: none` in CSS is sufficient for silent block. Do NOT add onClick guard or toast.

Do NOT use React Router, do NOT store progress in useState.
  </action>
  <verify>
    <automated>cd /Users/martha2022/Documents/Sleevo && npx tsc --noEmit 2>&1 | head -30</automated>
    <manual>File exists at src/components/LevelSelect/LevelSelect.tsx and exports LevelSelect function</manual>
  </verify>
  <done>LevelSelect.tsx compiles without TypeScript errors; exports `LevelSelect` component; renders grid of LEVELS.length cells; calls loadAllProgress() synchronously</done>
</task>

<task type="auto">
  <name>Task 2: LevelSelect CSS Module</name>
  <files>src/components/LevelSelect/LevelSelect.module.css</files>
  <action>
Create src/components/LevelSelect/LevelSelect.module.css.

Match the dark wood aesthetic from GameScreen.module.css. Key classes needed:

```css
/* Full-screen container â€” same card-capped pattern as GameScreen */
.viewport {
  width: 100%;
  height: 100dvh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg, #1a1008); /* same as GameScreen backdrop */
}

.screen {
  width: min(100%, 462px);
  height: 100dvh;
  display: flex;
  flex-direction: column;
  background: rgba(20, 12, 4, 0.97);
  overflow: hidden;
}

.header {
  padding: 20px 16px 12px;
  flex-shrink: 0;
}

.title {
  font-size: 20px;
  font-weight: 700;
  color: rgba(255, 220, 160, 0.95);
  margin: 0;
  letter-spacing: 0.02em;
}

/* Scrollable grid area */
.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  padding: 8px 12px;
  overflow-y: auto;
  flex: 1;
  /* custom scrollbar â€” subtle */
}

.hint {
  font-size: 11px;
  color: rgba(255, 200, 120, 0.45);
  text-align: center;
  padding: 10px 12px 16px;
  flex-shrink: 0;
}

/* Cell */
.cell {
  aspect-ratio: 1;
  border-radius: 12px;
  background: rgba(255, 235, 200, 0.06);
  border: 1px solid rgba(255, 200, 120, 0.14);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  cursor: pointer;
  transition: background 0.15s ease, transform 0.12s ease;
  -webkit-tap-highlight-color: transparent;
  color: rgba(255, 220, 160, 0.9);
  font-family: inherit;
  padding: 0;
}

.cell:active {
  transform: scale(0.94);
}

.cell[data-unlocked="false"] {
  opacity: 0.38;
  pointer-events: none;
  cursor: default;
}

.cell[data-focused="true"] {
  border-color: rgba(255, 200, 120, 0.6);
  background: rgba(255, 200, 120, 0.12);
  box-shadow: 0 0 0 2px rgba(255, 200, 120, 0.35);
}

.number {
  font-size: 18px;
  font-weight: 700;
  line-height: 1;
}

.stars {
  display: flex;
  gap: 2px;
  line-height: 1;
}

.star {
  font-size: 12px;
}

.starFilled {
  color: #f5b852;
}

.starEmpty {
  color: rgba(255, 200, 120, 0.22);
}

.lock {
  font-size: 14px;
  margin-top: 2px;
}
```

Use CSS custom properties (`var(--color-bg)`) only if they are defined in globals.css â€” if unsure, use literal values as shown above.
  </action>
  <verify>
    <automated>cd /Users/martha2022/Documents/Sleevo && npx tsc --noEmit 2>&1 | head -20 && echo "CSS exists:" && ls src/components/LevelSelect/LevelSelect.module.css</automated>
    <manual>CSS file exists; contains grid-template-columns: repeat(3, 1fr); data-unlocked/data-focused selectors present</manual>
  </verify>
  <done>LevelSelect.module.css exists with all required classes; TypeScript still compiles without errors after both tasks</done>
</task>

</tasks>

<verification>
Run `npx tsc --noEmit` from project root â€” must report 0 errors.
Verify src/components/LevelSelect/LevelSelect.tsx exports LevelSelect.
Verify src/components/LevelSelect/LevelSelect.module.css contains `.grid` with `grid-template-columns: repeat(3, 1fr)`.
</verification>

<success_criteria>
- LevelSelect.tsx compiles clean (tsc --noEmit passes)
- Exports `LevelSelect` component
- Reads progress via `loadAllProgress()` synchronously in component body
- 3-column grid layout in CSS
- Locked cells use data-unlocked="false" + pointer-events: none
- Focused cell uses scrollIntoView on mount
- No new npm dependencies
</success_criteria>

<output>
After completion, create `.planning/phases/03-progression-and-navigation/03-01-SUMMARY.md`
</output>
